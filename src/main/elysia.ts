import { setupCreateBoards } from "domain/features/create-boards";
import Elysia, { t } from "elysia";
import { cors } from "@elysiajs/cors";
import { DrizzleBoardProvider } from "infra/database/providers/drizzle-board-provider";
import { BoardRepository } from "infra/repositories/board-repository";
import { setupDisplayBoards } from "domain/features/display-boards";

const boardRepository = new BoardRepository(new DrizzleBoardProvider());


new Elysia()
	.use(cors())
	.get("/health", () => "it's healthy")
	.decorate(
		"createService",
		setupCreateBoards({
			repository: boardRepository,
		}),
	)
	.decorate(
        "fetchService",
        setupDisplayBoards({
            repository: boardRepository,
        }),
    )
	.post(
		"/api/create-boards",
		({ body: { name }, createService }) => {
			return createService({ name });
		},
		{
			body: t.Object({
				name: t.String(),
			}),
		}
	)
	.get("/api/boards", ({fetchService}) => {
		return fetchService({});
	})

	.listen(3000);
